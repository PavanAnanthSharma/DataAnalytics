{"_id":"ethpm-spec","_rev":"3-b2799c8e0a77a34ef690b6e20881f383","name":"ethpm-spec","description":"Ethereum Package Manager Specifications","dist-tags":{"latest":"1.0.1"},"versions":{"1.0.0":{"name":"ethpm-spec","version":"1.0.0","description":"Ethereum Package Manager Specifications","main":"index.js","scripts":{"build":""},"repository":{"type":"git","url":"git+https://github.com/ethpm/epm-spec.git"},"keywords":["ethereum","package","manager","epm","ethpm"],"author":"","license":"MIT","bugs":{"url":"https://github.com/ethpm/epm-spec/issues"},"homepage":"https://github.com/ethpm/epm-spec#readme","dependencies":{"json-schema-to-markdown":"^1.0.3"},"gitHead":"772718321dc7df7d4650274a504e083db4cba5d8","_id":"ethpm-spec@1.0.0","_shasum":"ee0c6705f839d86f449d6cb0247cff7f32091d28","_from":".","_npmVersion":"3.10.8","_nodeVersion":"6.9.1","_npmUser":{"name":"tcoulter","email":"tim@timothyjcoulter.com"},"dist":{"shasum":"ee0c6705f839d86f449d6cb0247cff7f32091d28","tarball":"https://registry.npmjs.org/ethpm-spec/-/ethpm-spec-1.0.0.tgz"},"maintainers":[{"name":"tcoulter","email":"tim@timothyjcoulter.com"}],"_npmOperationalInternal":{"host":"packages-12-west.internal.npmjs.com","tmp":"tmp/ethpm-spec-1.0.0.tgz_1485456431819_0.739242929732427"},"directories":{}},"1.0.1":{"name":"ethpm-spec","version":"1.0.1","description":"Ethereum Package Manager Specifications","main":"index.js","scripts":{"build":""},"repository":{"type":"git","url":"git+https://github.com/ethpm/epm-spec.git"},"keywords":["ethereum","package","manager","epm","ethpm"],"author":"","license":"MIT","bugs":{"url":"https://github.com/ethpm/epm-spec/issues"},"homepage":"https://github.com/ethpm/epm-spec#readme","dependencies":{"json-schema-to-markdown":"^1.0.3"},"gitHead":"aa4c5c7ae2cf76e00a96cf77df2e06374f88cf4c","_id":"ethpm-spec@1.0.1","_shasum":"ad3c09ae0492ad3d3ec7b94b7f5fd8057d4deb91","_from":".","_npmVersion":"3.10.8","_nodeVersion":"6.9.1","_npmUser":{"name":"tcoulter","email":"tim@timothyjcoulter.com"},"dist":{"shasum":"ad3c09ae0492ad3d3ec7b94b7f5fd8057d4deb91","tarball":"https://registry.npmjs.org/ethpm-spec/-/ethpm-spec-1.0.1.tgz"},"maintainers":[{"name":"tcoulter","email":"tim@timothyjcoulter.com"}],"_npmOperationalInternal":{"host":"packages-18-east.internal.npmjs.com","tmp":"tmp/ethpm-spec-1.0.1.tgz_1490889160768_0.7469689210411161"},"directories":{}}},"readme":"# EVM Smart Contract Packaging Specification\n\n[![Join the chat at https://gitter.im/ethpm/Lobby](https://badges.gitter.im/ethpm/Lobby.svg)](https://gitter.im/ethpm/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)\n\nEthereum Packaging Specification\n\n\n## Specification\n\n* [Release Lock File](./release-lock-file-spec.md)\n\n\n## Definitions\n\nThe following *types* are used within this specification.\n\n\n### Contract Name\n\nA string matching the regular expression `[_a-zA-Z][_a-zA-Z0-9]*`\n\n\n### Package Name\n\nA string matching the regular expression `[a-zA-Z][-_a-zA-Z0-9]*`\n\n\n### IPFS URI\n\nAn URI which matches the regular expression `^ipfs:/?/?.*$`\n\nThis allows for either one of the following ipfs supported formats:\n\n- `ipfs://Qm...`\n- `ipfs:/Qm...`\n- `ipfs:Qm...`\n\n\n### Chain Definition via BIP122 URI\n\nAn URI in the format `blockchain://<chain_id>/block/<block_hash>`\n\n* `chain_id` is the unprefixed genesis hash for the chain.\n* `block_hash` is the hash of a block on the chain.\n\nA chain is considered to match a chain definition if the the genesis block hash\nmatches the `chain_id` and the block defined by `block_hash` can be found on\nthat chain.  It is possible for multiple chains to match a single URI, in which\ncase all chains are considered valid matches\n\n\n## Resources\n\n* https://pad.riseup.net/p/7x3G896a3NLA\n* https://medium.com/@sdboyer/so-you-want-to-write-a-package-manager-4ae9c17d9527\n\n\n## Use Cases\n\nThe following use cases were considered during the creation of this\nspecification.\n\n1. [`owned`](#stand-alone-package-with-inheritable-contract): A package which contains contracts which are not meant to be used by themselves but rather as base contracts to provide functionality to other contracts through inheritance.\n2. [`transferable`](#package-with-inheritable-contract-and-a-dependency): A package which has a single dependency.\n3. [`standard-token`](#stand-alone-package-with-reusable-contract): A package which contains a reusable contract.\n4. [`safe-math-lib`](#stand-alone-package-with-a-deployed-contract): A package which contains deployed instance of one of the package contracts.\n5. [`piper-coin`](#package-which-uses-a-reusable-contract-from-a-dependency): A package which contains a deployed instance of a reusable contract from a dependency.\n6. [`escrow`](#stand-alone-package-that-links-against-local-library): A package which contains a deployed instance of a local contract which is linked against a deployed instance of a local library.\n7. [`wallet`](#package-with-deployed-instance-which-links-against-a-dependency-library): A package with a deployed instance of a local contract which is linked against a deployed instance of a library from a dependency.\n\n\nEach use case builds incrementally on the previous one.\n\n\n### <a id=\"stand-alone-package-with-inheritable-contract\" /> Stand Alone Package with an Inheritable Contract\n\nFor the first example we'll look at a package which only contains contracts\nwhich serve as base contracts for other contracts to inherit from but do not\nprovide any real useful functionality on their own.  The common *owned* pattern\nis a example for this use case.\n\n```javascript\npragma solidity ^0.4.0;\n\ncontract owned {\n    address owner;\n\n    function owned() {\n        owner = msg.sender;\n    }\n\n    modifier onlyowner { if (msg.sender != owner) throw; _; }\n}\n```\n\n> For this example we will assume this file is located in the solidity source file `./contracts/owned.sol`\n\nThe `owned` package contains a single solidity source source file which is\nintended to be used as a base contract for other contracts to be inherited\nfrom.  The package does not define any pre-deployed addresses for the *owned*\ncontract.\n\nThe smallest Release Lockfile for this package looks like this:\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"owned\",\n  \"sources\": {\n    \"./contracts/owned.sol\": \"ipfs://QmUjYUcX9kLv2FQH8nwc3RLLXtU3Yv5XFpvEjFcAKXB6xD\"\n  }\n}\n```\n\nA Release Lockfile which includes more than the minimum information would look like this.\n\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"owned\",\n  \"package_meta\": {\n    \"license\": \"MIT\",\n    \"authors\": [\n      \"Piper Merriam <pipermerriam@gmail.com>\"\n    ],\n    \"description\": \"Reusable contracts which implement a priviledged 'owner' model for authorization\",\n    \"keywords\": [\n      \"authorization\"\n    ],\n    \"links\": {\n      \"documentation\": \"ipfs://QmQiqrwqdav5bV8mtv4PqGksGcDWo43f7PAZYwhJqNEv2j\"\n    }\n  },\n  \"sources\": {\n    \"./contracts/owned.sol\": \"ipfs://QmUjYUcX9kLv2FQH8nwc3RLLXtU3Yv5XFpvEjFcAKXB6xD\"\n  }\n}\n```\n\nThis fully fleshed out Release Lockfile is meant to demonstrate various pieces\nof optional data that can be included.  However, for the remainder of our\nexamples we will be using minimalistic lockfiles to keep our examples as\nsuccinct as possible.\n\n\n### <a id=\"package-with-inheritable-contract-and-a-dependency\" /> Package with an Inheritable Contract and a Dependency\n\nNow that we've seen what a simple package looks like, lets see how to\ndependencies are declared.\n\nThe next package will implement the *transferable* pattern and will depend on\nour `owned` package for the authorization mechanism to ensure that only the\ncontract owner may transfer ownership.  The `transferable` package will\ncontain a single solidity source file `./contracts/transferable.sol`.\n\n```javascript\npragma solidity ^0.4.0;\n\nimport {owned} from \"owned/contracts/owned.sol\";\n\ncontract transferable is owned {\n\tevent OwnerChanged(address indexed prevOwner, address indexed newOwner);\n\n    function transferOwner(address newOwner) public onlyowner returns (bool) {\n\t\tOwnerChanged(owner, newOwner);\n\t\towner = newOwner;\n\t\treturn true;\n    }\n}\n```\n\nThe EPM spec is designed to provide as high a guarantee as possible that builds\nare deterministic and reproducable.  To ensure that each package you install\ngets the *exact* dependencies it needs, all dependencies are declared as\ncontent addressed URIs.  This ensures that when a package manager fetches a\ndependency it always gets the right one.\n\nThe IPFS URI for the previous `owned` Release Lockfile turns out to be\n`ipfs://QmXDf2GP67otcF2gjWUxFt4AzFkfwGiuzfexhGuotGTLJH` which is what we will\nuse in our `transferable` package to declare the dependency.  The Release\nLockfile for our package looks like the following.\n\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"transferable\",\n  \"sources\": {\n    \"./contracts/transferable.sol\": \"ipfs://QmZ6Zg1iEejuJ18LFczowe7dyaxXm4KC4xTgnCkqwJZmAp\"\n  },\n  \"build_dependencies\": {\n\t\"owned\": \"ipfs://QmXDf2GP67otcF2gjWUxFt4AzFkfwGiuzfexhGuotGTLJH\"\n  }\n}\n```\n\nIt will be up to the package management software to determine how the `owned`\ndependency actually gets installed as well as handling any import remappings\nnecessary to make the import statement work.\n\n\n### <a id=\"stand-alone-package-with-reusable-contract\" /> Stand Alone Package with a Reusable Contract\n\nIn this next example we'll look at a package which contains a reusable\ncontract.  This means that the package provides a contract which can be on its\nown in some manner.  For this example we will be creating a package which\nincludes a reusable standard\n[ERC20](https://github.com/ethereum/EIPs/issues/20) token contract.\n\n> The source code for these contracts was pulled from the [SingularDTV](https://github.com/ConsenSys/singulardtv-contracts) github repository.  Thanks to them for a very well written contract.\n\nThis package will contain two solidity source files.\n\n* [`./contracts/AbstractToken.sol`](./examples/standard-token/contracts/AbstractToken.sol)\n* [`./contracts/StandardToken.sol`](./examples/standard-token/contracts/StandardToken.sol)\n\nGiven that these source files are relatively large they will not be included\nhere within the guide but can be found in the\n[`./examples/standard-token/`](./examples/standard-token/) directory within\nthis repository.\n\nSince this package includes a contract which may be used as-is, our Release\nLockfile is going to contain additional information from our previous examples,\nspecifically, the `contract_types` section.  Since we expect people to compile\nthis contract theirselves we won't need to include any of the contract\nbytecode, but it will be useful to include the contract ABI and Natspec\ninformation.  Our lockfile will look something like the following.  The\ncontract ABI and NatSpec sections have been truncated to improve legibility.\nThe full Release Lockfile can be found\n[here](./examples/standard-token/1.0.0.json)\n\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"standard-token\",\n  \"sources\": {\n    \"./contracts/AbstractToken.sol\": \"ipfs://QmQMXDprXxCunfQjA42LXZtzL6YMP8XTuGDB6AjHzpYHgk\",\n    \"./contracts/StandardToken.sol\": \"ipfs://QmNLr7DzmiaQvk25C8bADBnh9bF5V3JfbwHS49kyoGGEHz\"\n  },\n  \"contract_types\": {\n    \"StandardToken\": {\n      \"abi\": [...],\n      \"natspec\": {\n        \"author\": \"Stefan George - <stefan.george@consensys.net>\",\n        \"title\": \"Standard token contract\",\n        \"methods\": {\n          \"allowance(address,address)\": {\n            \"details\": \"Returns number of allowed tokens for given address.\",\n            \"params\": {\n              \"_owner\": \"Address of token owner.\",\n              \"_spender\": \"Address of token spender.\"\n            }\n          },\n          ...\n        }\n      }\n    }\n  }\n}\n```\n\nWhile it is not required to include the contract ABI and NatSpec information,\nit does provide those using this package with they data they would need to\ninteract with an instance of this contract without having to regenerate this\ninformation from source.\n\n\n### <a id=\"stand-alone-package-with-a-deployed-contract\" /> Stand Alone Package with a Deployed Contract\n\nNow that we've seen what a package looks like which includes a fully functional\ncontract that is ready to be deployed, lets explore a package that also\nincludes a deployed instance of that contract.\n\nSolidity Libraries are an\nexcellend example of this type of package, so for this example we are going to\nwrite a library for *safe* math operations called `safe-math-lib`.  This\nlibrary will implement functions to allow addition and subtraction without\nneeding to check for underflow or overflow conditions.  Our package will have a\nsingle solidity source file `./contracts/SafeMathLib.sol`\n\n\n```javascript\npragma solidity ^0.4.0;\n\n\n/// @title Safe Math Library\n/// @author Piper Merriam <pipermerriam@gmail.com>\nlibrary SafeMathLib {\n    /// @dev Subtracts b from a, throwing an error if the operation would cause an underflow.\n    /// @param a The number to be subtracted from\n    /// @param b The amount that should be subtracted\n    function safeAdd(uint a, uint b) returns (uint) {\n        if (a + b > a) {\n            return a + b;\n        } else {\n            throw;\n        }\n    }\n\n    /// @dev Adds a and b, throwing an error if the operation would cause an overflow.\n    /// @param a The first number to add\n    /// @param b The second number to add\n    function safeSub(uint a, uint b) returns (uint) {\n        if (b <= a) {\n            return a - b;\n        } else {\n            throw;\n        }\n    }\n}\n```\n\nThis will be our first package which includes the `deployments` section which is the\nlocation in the Release Lockfile where information about deployed contract\ninstances is found.  Lets look at the Release Lockfile for this package.  Some\nparts have been truncated for readability but the full file can be found\n[here](./examples/safe-math-lib/1.0.0.json)\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"safe-math-lib\",\n  \"sources\": {\n    \"./contracts/SafeMathLib.sol\": \"ipfs://QmVN1p6MmMLYcSq1VTmaSDLC3xWuAUwEFBFtinfzpmtzQG\"\n  },\n  \"contract_types\": {\n    \"SafeMathLib\": {\n      \"bytecode\": \"0x606060405234610000575b60a9806100176000396000f36504062dabbdf050606060405260e060020a6000350463a293d1e88114602e578063e6cb901314604c575b6000565b603a600435602435606a565b60408051918252519081900360200190f35b603a6004356024356088565b60408051918252519081900360200190f35b6000828211602a57508082036081566081565b6000565b5b92915050565b6000828284011115602a57508181016081566081565b6000565b5b9291505056\",\n      \"runtime_bytecode\": \"0x6504062dabbdf050606060405260e060020a6000350463a293d1e88114602e578063e6cb901314604c575b6000565b603a600435602435606a565b60408051918252519081900360200190f35b603a6004356024356088565b60408051918252519081900360200190f35b6000828211602a57508082036081566081565b6000565b5b92915050565b6000828284011115602a57508181016081566081565b6000565b5b9291505056\",\n      \"abi\": [\n        ...\n      ],\n      \"compiler\": {\n        \"type\": \"solc\",\n        \"version\": \"0.4.6+commit.2dabbdf0.Darwin.appleclang\",\n        \"settings\": {\n            \"optimize\": true\n        }\n      },\n      \"natspec\": {\n        \"title\": \"Safe Math Library\",\n        \"author\": \"Piper Merriam <pipermerriam@gmail.com>\",\n        ...\n      }\n    }\n  },\n  \"deployments\": {\n    \"blockchain://41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d/block/1e96de11320c83cca02e8b9caf3e489497e8e432befe5379f2f08599f8aecede\": {\n      \"SafeMathLib\": {\n        \"contract_type\": \"SafeMathLib\",\n        \"address\": \"0x8d2c532d7d211816a2807a411f947b211569b68c\",\n        \"transaction\": \"0xaceef751507a79c2dee6aa0e9d8f759aa24aab081f6dcf6835d792770541cb2b\",\n        \"block\": \"0x420cb2b2bd634ef42f9082e1ee87a8d4aeeaf506ea5cdeddaa8ff7cbf911810c\"\n      }\n    }\n  }\n}\n```\n\nThe first thing to point out is that unlike our `standard-token` contract,\nwe've included the `bytecode`, `runtime_bytecode` and `compiler` information in\nthe `SafeMathLib` section of the `contract_type` definition.  This is because\nwe are also including a deployed instance of this contract and need to require\nadequate information for package managers to verify that the contract sound at\nthe deployed address is in fact from the source code included in this package.\n\nThe next thing to look at is the `deployments` section. The first thing you\nshould see is the\n[BIP122](https://github.com/bitcoin/bips/blob/master/bip-0122.mediawiki) URI.\n\n```\nblockchain://41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d/block/1e96de11320c83cca02e8b9caf3e489497e8e432befe5379f2f08599f8aecede\n```\n\nThis URI defines the chain on which the `SafeMathLib` library was\ndeployed.  The first hash you see,\n`41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d` is the\ngenesisi block hash for the Ropsten test network.  The later hash\n`1e96de11320c83cca02e8b9caf3e489497e8e432befe5379f2f08599f8aecede` is the block\nhash for block numbr 168,238 from the Ropsten chain.\n\nUnder that URI there is a single *contract instance*.  It specifies that it's\n*contract type* is `SafeMathLib`, the address that the *contract instance* can\nbe found at, the transaction hash for the transaction that deployed the\ncontract, and the block hash in which the deploying transaction was mined.\n\n\n### <a id=\"package-which-uses-a-reusable-contract-from-a-dependency\" /> Package which uses a Reusable Contract from a depenency\n\nFor our next example we'll be creating a package includes a deployed instance\nof a *contract type* from that comes from a package dependency.  This differs\nfrom our previous `safe-math-lib` example where our deployment is referencing a\nlocal contract from the local `contract_types`.  In this package's Release\nLockfile we will be referencing a `contract_type` from one of the\n`build_dependencies`\n\nWe are going to use the `standard-token` package we created earlier and include\na deployed version of the `StandardToken` contract.\n\nOur package will be called `piper-coin` and will not contain any source files\nsince it merely makes use of the contracts from the `standard-token` package.\nThe Release Lockfile is listed below with some sections truncated for improved\nreadability.  The full Release Lockfile can be found at\n[`./examples/piper-coin/1.0.0.json`](./examples/piper-coin/1.0.0.json)\n\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"piper-coin\",\n  \"deployments\": {\n    \"blockchain://41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d/block/cff59cd4bc7077ae557eb39f84f869a1ea7955d52071bad439f0458383a78780\": {\n      \"PiperCoin\": {\n        \"contract_type\": \"standard-token:StandardToken\",\n        \"address\": \"0x11cbb0604e47e0f8501b8f56c1c05f92088dc1b0\",\n        \"transaction\": \"0x1f8206683e4b1dea1fd2e7299b7606ff27440f33cb994b42b4ecc4b0f83a210f\",\n        \"block\": \"0xe94a700ef9aa2d7a1b07321838251ea4ade8d4d682121f67899f401433a0d910\",\n        \"bytecode\": \"...\",\n        \"runtime_bytecode\": \"...\",\n        \"compiler\": {\n          \"type\": \"solc\",\n          \"version\": \"0.4.6+commit.2dabbdf0.Darwin.appleclang\"\n        }\n      }\n    }\n  },\n  \"build_dependencies\": {\n    \"standard-token\": \"ipfs://QmegJYswSDXUJbKWBuTj7AGBY15XceKxnF1o1Vo2VvVPLQ\"\n  }\n}\n```\n\nMost of this should be familiar but it's worth pointing out how we reference\n*contract types* from dependencies.  Under the `PiperCoin` entry within the\ndeployments you should see that the `contract_type` key is set to\n`standard-token:StandardToken`.  The first portion represents the name of the\npackage dependency within the `build_dependencies` that should be used.  The\nlater portion indicates the *contract type* that should be used from that\ndependencies *contract types*.\n\n\n### <a id=\"stand-alone-package-that-links-against-local-library\" /> Stand Alone package with a deployed Library and a contract which Links against that Library\n\nIn the previous `safe-math-lib` package we demonstrated what a package with a\ndeployed instance of one of it's local contracts looks like.  In this example\nwe will build on that concept with a package which includes a library and a\ncontract which uses that library as well as deployed instances of both.\n\nThe package will be called `escrow` and will implementing a simple escrow\ncontract.  The escrow contract will make use of a library to safely send ether.\nBoth the contract and library will be part of the package found in the\nfollowing two solidity source files.\n\n* [`./contracts/SafeSendLib.sol`](./examples/escrow/SafeSendLib.sol)\n* [`./contracts/Escrow.sol`](./examples/escrow/Escrow.sol)\n\nThe full source for these files can be found here:\n[`./examples/escrow/`](./examples/escrow/).\n\nThe Release Lockfile is listed below with some sections truncated for improved\nreadability.  The full Release Lockfile can be found at\n[`./examples/escrow/1.0.0.json`](./examples/escrow/1.0.0.json)\n\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"escrow\",\n  \"sources\": {\n    \"./contracts/SafeSendLib.sol\": \"ipfs://QmcnzhWjaV71qzKntv4burxyix9W2yBA2LrJB4k99tGqkZ\",\n    \"./contracts/Escrow.sol\": \"ipfs://QmSwmFLT5B5aag485ZWvHmfdC1cU5EFdcqs1oqE5KsxGMw\"\n  },\n  \"contract_types\": {\n    \"SafeSendLib\": {\n      ...\n    },\n    \"Escrow\": {\n      ...\n    }\n  },\n  \"deployments\": {\n    \"blockchain://41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d/block/e76cf1f29a4689f836d941d7ffbad4e4b32035a441a509dc53150c2165f8e90d\": {\n      \"SafeMathLib\": {\n        \"contract_type\": \"SafeSendLib\",\n        \"address\": \"0x80d7f7a33e551455a909e1b914c4fd4e6d0074cc\",\n        \"transaction\": \"0x74561167f360eaa20ea67bd4b4bf99164aabb36b2287061e86137bfa0d35d5fb\",\n        \"block\": \"0x46554e3cf7b768b1cc1990ad4e2d3a137fe9373c0dda765f4db450cd5fa64102\"\n      },\n      \"Escrow\": {\n        \"contract_type\": \"Escrow\",\n        \"address\": \"0x35b6b723786fd8bd955b70db794a1f1df56e852f\",\n        \"transaction\": \"0x905fbbeb6069d8b3c8067d233f58b0196b43da7a20b839f3da41f69c87da2037\",\n        \"block\": \"0x9b39dcab3d665a51755dedef56e7c858702f5817ce926a0cd8ff3081c5159b7f\",\n        \"link_dependencies\": [\n          {\"offset\": 524, \"value\": \"SafeSendLib\"},\n          {\"offset\": 824, \"value\": \"SafeSendLib\"}\n        ]\n      }\n    }\n  }\n}\n```\n\nThis Release Lockfile is the first one we've seen thus far that include the\n`link_dependencies` section within one of the *contract instances*.  The\n`runtime_bytecode` value for the `Escrow` contract has been excluded from the\nexample above for readability, but the full value is as follows (wrapped to 80\ncharacters).\n\n```\n0x606060405260e060020a600035046366d003ac811461003457806367e404ce1461005d57806369\nd8957514610086575b610000565b3461000057610041610095565b60408051600160a060020a0390\n92168252519081900360200190f35b34610000576100416100a4565b60408051600160a060020a03\n9092168252519081900360200190f35b34610000576100936100b3565b005b600154600160a06002\n0a031681565b600054600160a060020a031681565b60005433600160a060020a0390811691161415\n61014857600154604080516000602091820152815160e260020a6324d048c7028152600160a06002\n0a03938416600482015230909316316024840152905173__SafeSendLib_____________________\n______92639341231c926044808301939192829003018186803b156100005760325a03f415610000\n57506101e2915050565b60015433600160a060020a039081169116141561002f5760008054604080\n51602090810193909352805160e260020a6324d048c7028152600160a060020a0392831660048201\n52309092163160248301525173__SafeSendLib___________________________92639341231c92\n60448082019391829003018186803b156100005760325a03f41561000057506101e2915050565b61\n0000565b5b5b56\n```\n\nYou can see that the placeholder `__SafeSendLib___________________________` is\npresent in two locations within this bytecode.  This is referred to as a *link\nreference*.  The entries in the `link_dependencies` section of a *contract\ninstance* describe how these *link references* should be filled in.\n\nThe `offset` value specifies the number of characters into the unprefixed\nbytecode where the replacement should begin.  The `value` defines what address\nshould be used to replace the *link reference*.  In this case, the `value` is\nreferencing the `SafeSendLib` *contract instance* from this release lockfile.\n\n\n### <a id=\"package-with-deployed-instance-which-links-against-a-dependency-library\" /> Package with a contract with link dependencies on a contract from a package dependency\n\nNow that we've seen how we can handle linking dependencies that rely on\ndeployed *contract instances* from the local package we'll explore an example\nwith link dependencies that rely on contracts from the package dependencies.\n\nIn this example we'll be writing the `wallet` package which includes a wallet\ncontract which makes use of the previous `safe-math-lib` package.  We will also\nmake use of the `owned` package from our very first example to handle\nauthorization.  Our package will contain a single solidity source file\n[`./contracts/Wallet.sol`](./examples/wallet/contracts/Wallet.sol).  The\nversion below has been trimmed for readability.\n\n\n```javascript\nimport {SafeMathLib} from \"safe-math-lib/contracts/SafeMathLib.sol\";\nimport {owned} from \"owned/contracts/owned.sol\";\n\ncontract Wallet is owned {\n    using SafeMathLib for uint;\n\n    mapping (address => uint) allowances;\n\n    function() {\n    }\n\n    function send(address recipient, uint value) public onlyowner {\n        recipient.send(value);\n    }\n\n    function approve(address recipient, uint value) public onlyowner {\n        allowances[recipient] = value;\n    }\n\n    function withdraw(uint value) public {\n        allowances[msg.sender] = allowances[msg.sender].safeSub(value);\n        if (!msg.sender.send(value)) throw;\n    }\n}\n```\n\nThe Release Lockfile for our `wallet` package can been seen below.  It has been\ntrimmed to improve readability.  The full Release Lockfile can be found at\n[`./examples/wallet/1.0.0.json`](./examples/wallet/1.0.0.json)\n\n\n```javascript\n{\n  \"lockfile_version\": \"1\",\n  \"version\": \"1.0.0\",\n  \"package_name\": \"wallet\",\n  \"sources\": {\n    \"./contracts/Wallet.sol\": \"ipfs://QmYKibsXPSTR5UjywQHX8SM4za1K3QHadtFGWmZqGA4uE9\"\n  },\n  \"contract_types\": {\n    \"Wallet\": {\n      \"bytecode\": \"...\",\n      \"runtime_bytecode\": \"...\",\n      ...\n    }\n  },\n  \"deployments\": {\n    \"blockchain://41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d/block/3ececfa0e03bce2d348279316100913c42ca2dcd51b8bc8d2d87ef2dc6a479ff\": {\n      \"Wallet\": {\n        \"contract_type\": \"Wallet\",\n        \"address\": \"0xcd0f8d7dab6c682d3726693ef3c7aaacc6431d1c\",\n        \"transaction\": \"0x5c113857925ae0d866341513bb0732cd799ebc1c18fcec253bbc41d2a029acd4\",\n        \"block\": \"0xccd130623ad3b25a357ead2ecfd22d38756b2e6ac09b77a37bd0ecdf16249765\",\n        \"link_dependencies\": [\n          {\"offset\": 678, \"value\": \"safe-math-lib:SafeMathLib\"}\n        ]\n      }\n    }\n  },\n  \"build_dependencies\": {\n    \"owned\": \"ipfs://QmXDf2GP67otcF2gjWUxFt4AzFkfwGiuzfexhGuotGTLJH\",\n    \"safe-math-lib\": \"ipfs://QmfUwis9K2SLwnUh62PDb929JzU5J2aFKd4kS1YErYajdq\"\n  }\n}\n```\n\nJust like our previous example, the `runtime_bytecode` has been omitted for\nimproved readability, but the full value is as follows (wrapped to 80\ncharacters).\n\n```\n0x606060405236156100355760e060020a6000350463095ea7b381146100435780632e1a7d4d1461\n006a578063d0679d341461008e575b34610000576100415b5b565b005b3461000057610056600435\n6024356100b5565b604080519115158252519081900360200190f35b346100005761005660043561\n00f8565b604080519115158252519081900360200190f35b34610000576100566004356024356101\nda565b604080519115158252519081900360200190f35b6000805433600160a060020a0390811691\n16146100d157610000565b50600160a060020a038216600090815260016020819052604090912082\n90555b5b92915050565b600160a060020a0333166000908152600160209081526040808320548151\n830184905281517fa293d1e800000000000000000000000000000000000000000000000000000000\n8152600481019190915260248101859052905173__SafeMathLib___________________________\n9263a293d1e89260448082019391829003018186803b156100005760325a03f41561000057505060\n4080518051600160a060020a0333166000818152600160205293842091909155925084156108fc02\n91859190818181858888f1935050505015156101d157610000565b5060015b919050565b60008054\n33600160a060020a039081169116146101f657610000565b604051600160a060020a038416908315\n6108fc029084906000818181858888f19450505050505b5b9291505056\n```\n\nAs you can see, this bytecode contains a *link* reference to the `SafeMathLib`\nlibrary from the `safe-math-lib` package dependency.   If you look in the\n`link_dependencies` section of our `Wallet` contract you'll see it's items are\nsimilar to the ones from our previous example.\n\n\n```javascript\n\"link_dependencies\": [\n  {\"offset\": 678, \"value\": \"safe-math-lib:SafeMathLib\"}\n]\n```\n\n\nHowever, unlike the previous example which linked against a *local* contract\ntype,  `value` portion is prefixed with the name of the package which contains\nthe address of the contract instance that this should be linked against.\n","maintainers":[{"email":"christophergewecke@gmail.com","name":"cgewecke"},{"email":"benjamin.c.burns@gmail.com","name":"benjamincburns"},{"email":"nick@gnidan.org","name":"gnidan"},{"email":"tim@timothyjcoulter.com","name":"tcoulter"}],"time":{"modified":"2018-08-22T15:00:29.053Z","created":"2017-01-26T18:47:12.051Z","1.0.0":"2017-01-26T18:47:12.051Z","1.0.1":"2017-03-30T15:52:43.028Z"},"homepage":"https://github.com/ethpm/epm-spec#readme","keywords":["ethereum","package","manager","epm","ethpm"],"repository":{"type":"git","url":"git+https://github.com/ethpm/epm-spec.git"},"bugs":{"url":"https://github.com/ethpm/epm-spec/issues"},"license":"MIT","readmeFilename":"README.md","_attachments":{},"_etag":"W/\"3611266031ea77c9d9cad73171029901\"","_lastModified":"Wed, 22 Aug 2018 15:00:30 GMT","_cached":true}